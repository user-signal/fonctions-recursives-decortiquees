<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>

    <title>Les </title>

    <meta name="description" content="Les fonctions (récursives) décortiquées"/>
    <meta name="author" content="Frédéric Cabestre"/>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="./dist/theme/transparents.css" id="theme"/>

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="./plugin/highlight/zenburn.css"/>
</head>

<body>
<div class="reveal">
    <div class="slides">

        <section>
            <h2>Les fonctions <span class="green">(récursives)</span> décortiquées</h2>
        </section>

        <section>
            <div style="display: flex; justify-content: space-between">
                <div style="margin-left: 2em; display: flex; flex-direction: column">
                    <div style="margin-top: 1em; text-align: left" class="green">Frédéric Cabestre</div>
                    <div style="font-size: smaller; text-align: left" class="blue">@fcabestre</div>
                </div>
            </div>
            <blockquote style="margin-top: 12em; margin-right: 2em; margin-bottom: 100%">
                I'm not a number, I'm a freelance.
                <div style="font-size: smaller">&mdash; Number 6, <a href="https://en.wikipedia.org/wiki/The_Prisoner">The
                    Prisoner</a></div>
            </blockquote>
        </section>

        <section>
            <h2>Programmation Structutrée</h2>
            <img src="images/GotoHarmful.png" alt="Goto Considered Harmful">    
        </section>
        
        <section>
            <span style="font-size: smaller; text-align: left; display: flex; margin: 1ex 0 0 1em">[Première Partie]</span>
            <h2 style="margin-top: 3em">Théorie</h2>
            <blockquote style="margin-top: 5em; margin-right: 2em; margin-bottom: 100%">
                « Un jour j'irai vivre en Théorie, 
                <div>car en Théorie tout se passe bien. »</div>
                <div style="font-size: smaller">&mdash; Pierre Desproges</div>
            </blockquote>
        </section>
        
        <section>
            <h2 style="margin-bottom: 1.5em"><span style="text-transform:lowercase">&lambda;</span>-Calcul</h2>
            <div style="margin-bottom: 100%;  display: grid; grid-template-columns: 3fr 2fr">
                <div class="fragment" data-fragment-index="1" style="justify-self: center">$x$</div><div class="fragment" data-fragment-index="1" style="justify-self: start"> Variable</div>
                <div class="fragment" data-fragment-index="1" style="justify-self: center">$\lambda x.\,M$</div><div class="fragment" data-fragment-index="1" style="justify-self: start"> Abstraction</div>
                <div class="fragment" data-fragment-index="1" style="justify-self: center; margin-bottom: 2.5em">$M\,N$</div><div class="fragment" data-fragment-index="1" style="margin-bottom: 2.5em; justify-self: start"> Application</div>
                <div class="fragment" data-fragment-index="2" style="justify-self: center">$\lambda x.\,M[x] \rightarrow \lambda y.\,M[y]$</div><div class="fragment" data-fragment-index="2" style="justify-self: start">$\alpha$-conversion</div>
                <div class="fragment" data-fragment-index="2" style="justify-self: center">$(\lambda x.\,M)\:E \rightarrow M[x:=E]$</div><div class="fragment" data-fragment-index="2" style="justify-self: start">$\beta$-reduction</div>
                <div class="fragment" data-fragment-index="2" style="justify-self: center">$\lambda x.\,(f\,x) \rightarrow f$</div><div class="fragment" data-fragment-index="2" style="justify-self: start">$\eta$-reduction</div>
            </div>
        </section>
        
        <section>
            <h2 style="margin-bottom: 1.5em"><span style="text-transform:lowercase">&lambda;</span>-Calcul</h2>
            <div style="margin-bottom: 100%;  display: grid; grid-template-columns: 3fr 2fr">
                <div style="justify-self: center">$x$</div><div style="justify-self: start"> Variable</div>
                <div style="justify-self: center">$\lambda x.\,M$</div><div style="justify-self: start"> Abstraction</div>
                <div style="justify-self: center; margin-bottom: 2.5em">$M\,N$</div><div style="margin-bottom: 2.5em; justify-self: start"> Application</div>
                <div style="justify-self: center">$\lambda x.\,M[x] \rightarrow \lambda y.\,M[y]$</div><div style="justify-self: start">$\alpha$-conversion</div>
                <div class="orange" style="justify-self: center">$(\lambda x.\,M)\:E \rightarrow M[x:=E]$</div><div class="orange" style="justify-self: start">$\beta$-reduction</div>
                <div style="justify-self: center">$\lambda x.\,(f\,x) \rightarrow f$</div><div style="justify-self: start">$\eta$-reduction</div>
            </div>
        </section>

        <section>
            <h2>Encodages</h2>
            <div class="list" style="margin-top: 4ex; margin-bottom: 100%">
                <div class="item fragment" data-fragment-index="1">Entiers :</div>
                <div class="item fragment" data-fragment-index="1" style="margin-top: 1ex;margin-left: 7em">$0 = \lambda f.\, \lambda x.\,x$</div>
                <div class="item fragment" data-fragment-index="1" style="margin-left: 7em">$1 = \lambda f.\, \lambda x.\,f\,x$</div>
                <div class="item fragment" data-fragment-index="1" style="margin-left: 7em">$2 = \lambda f.\, \lambda x.\,f\,(f\,x)$</div>
                <div class="item fragment" data-fragment-index="2" style="margin-top: 1.5ex; margin-left: 6.75em">$S = \lambda n.\,\lambda f.\,\lambda x.\,f\,(n\,f\,x)$</div>
                <div class="item fragment" style="margin-top: 2ex">Point fixe :</div>
                <div class="green item fragment" style="margin-top: 1ex;margin-left: 6.6em">$Y = \lambda g.\,(\lambda x.\,g\,(x\,x))\,(\lambda x.\,g\,(x\,x))$</div>
            </div>
        </section>

        <section>
            <h2>Curryfication</h2>
            <h3>(ou Schönfinkelification ?)</h3>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 3em"><code class="C#" style="max-height: 800px">
                        public static int Add(int x, int y) => x + y;
                        
                        Add(42, 19)      // -> 61
            </code></pre>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 1em"><code data-no-escape class="C#" style="max-height: 800px">
                        public static Func&lt;int, int&gt; AddCurried(int x) => y => x + y;
                                
                        AddCurried(42)(19) // -> 61
            </code></pre>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 1em; margin-bottom: 100%"><code data-no-escape class="C#" style="max-height: 800px">
                        var addPartial = AddCurried(42);
                
                        addPartial(19)   // -> 61
            </code></pre>
        </section>

        <section>
            <h2>Sémantique</h2>
            <div class="list" style="margin-top: 5ex; margin-bottom: 100%">
                <div class="fragment item" data-fragment-index="1">Donner un <span class="orange">sens</span> aux expressions syntaxiques</div>
                <div class="fragment item" data-fragment-index="1">d'un langage dans un <span class="orange">autre</span> langage</div>
                <div class="fragment item" style="margin-top: 2ex">Plus ou moins <span class="orange">formelle</span></div>
                <div class="fragment item">Plus ou moins <span class="orange">abstraite</span></div>
                <div class="item" style="margin-top: 2ex"><span class="fragment"><span class="green">Axiomatique</span>, </span><span class="fragment"><span class="green">Dénotationnelle</span>, </span><span class="fragment green">Opérationnelle</span></div>
            </div>
        </section>
        
        <section>
            <h2>Dénotationelle</h2>
            <div class="list" style="margin-top: 3ex; margin-bottom: 100%">
                <div class="item fragment">$\langle 2 + 1 \rangle \neq \langle 1 + 2 \rangle$</div>
                <div class="item fragment" style="margin-top: 2ex">$\lceil\langle 2 + 1 \rangle\rceil$</div>
                <div class="item fragment">$\lceil\langle 2 \rangle\rceil$ <span class="magenta">$+$</span> $\lceil\langle 1 \rangle\rceil$</div>
                <div class="item fragment"><span class="magenta">$2 + 1$</span></div>
                <div class="item fragment"><span class="magenta">$3$</span></div>
                <div class="item fragment" style="margin-top: 2ex">$\lceil\langle 1 + 2 \rangle\rceil$</div>
                <div class="item fragment">$\lceil\langle 1 \rangle\rceil$ <span class="magenta">$+$</span> $\lceil\langle 2 \rangle\rceil$</div>
                <div class="item fragment"><span class="magenta">$1 + 2$</span></div>
                <div class="item fragment"><span class="magenta">$3$</span></div>
            </div>
        </section>
        
        <section>
            <h2>Opérationelle</h2>
            <div class="list" style="margin-top: 4ex; margin-bottom: 100%">
                <div class="item fragment">$\{\varnothing\} \;\Uparrow\; \lceil\langle 2 + 1 \rangle\rceil$</div>
                <div class="item fragment">$\{$ <span class="magenta">2</span>$\,\centerdot\,$<span class="magenta">1</span> $\,\centerdot\,\varnothing\} \;\Uparrow\; \lceil\langle + \rangle\rceil$</div>
                <div class="item fragment">$\{$ <span class="magenta">3</span> $\,\centerdot\,\varnothing\} \;\Uparrow\; \lceil\langle \rangle\rceil$</div>
                <div class="item fragment" style="margin-top: 3ex">$\{\varnothing\} \;\Uparrow\; \lceil\langle 1 + 2 \rangle\rceil$</div>
                <div class="item fragment">$\{$ <span class="magenta">1</span>$\,\centerdot\,$<span class="magenta">2</span> $\,\centerdot\,\varnothing\} \;\Uparrow\; \lceil\langle + \rangle\rceil$</div>
                <div class="item fragment">$\{$ <span class="magenta">3</span> $\,\centerdot\,\varnothing\} \;\Uparrow\; \lceil\langle \rangle\rceil$</div>
            </div>
        </section>
        
        <section>
            <h2>Ordre de réduction</h2>
            <div class="list" style="margin-top: 4ex; margin-bottom: 100%">
                <div class="fragment item" data-fragment-index="1">Si on pose :</div>
                <div class="fragment item" data-fragment-index="1" style="margin-top: 1ex; margin-left: 10em">$id = \lambda x.\,x$</div>
                <div class="fragment item" data-fragment-index="2" style="margin-top: 1ex">Soit l'expression :</div>
                <div class="fragment item" data-fragment-index="2" style="margin-top: 1ex; margin-left: 10em">$id\,(id\,(\lambda z.\,id\, z))$</div>
                <div class="fragment item" data-fragment-index="3" style="margin-top: 1ex">On a les <span class="orange">redex</span> :</div>
                <div class="fragment item" style="margin-top: 1ex; margin-left: 10em">$id\,(id\,(\lambda z.\,\underline{id\, z}))$</div>
                <div class="fragment item" style="margin-left: 10em">$id\,(\underline{id\,(\lambda z.\,id\, z)})$</div>
                <div class="fragment item" style="margin-left: 10em">$\underline{id\,(id\,(\lambda z.\,id\, z))}$</div>
            </div>
        </section>
        
        <section>
            <h2><span style="text-transform:lowercase">&beta;</span>-réduction complète</h2>
            <div class="list" style="margin-bottom: 100%; margin-top: 4ex">
                <div class="fragment item">On prend n'importe quel <span class="orange">redex</span></div>
                <div class="fragment item" style="margin-top: 5ex; margin-left: 10em">$id\:(\underline{id\:(\lambda z.\:id\: z)})$</div>
                <div class="fragment item" style="margin-left: 10em">$id\:(\lambda z.\:\underline{id\: z})$</div>
                <div class="fragment item" style="margin-left: 10em">$\underline{id\:(\lambda z.\: z)}$</div>
                <div class="fragment item green" style="margin-left: 10em">$\lambda z.\: z$</div>
            </div>
        </section>
        
        <section>
            <h2>Ordre normal</h2>
            <div class="list" style="margin-bottom: 100%; margin-top: 4ex">
                <div class="fragment item">On prend <span class="orange">redex</span> le plus extérieur et le plus à gauche</div>
                <div class="fragment item" style="margin-top: 5ex; margin-left: 10em">$\underline{id\:(id\:(\lambda z.\:id\: z))}$</div>
                <div class="fragment item" style="margin-left: 10em">$\underline{id\:(\lambda z.\:id\: z)}$</div>
                <div class="fragment item" style="margin-left: 10em">$\lambda z.\:\underline{id\: z}$</div>
                <div class="fragment item green" style="margin-left: 10em">$\lambda z.\: z$</div>
            </div>
        </section>
        
        <section>
            <h2>Appel par nom</h2>
            <div class="list" style="margin-bottom: 100%; margin-top: 5ex">
                <div class="fragment item">On prend <span class="orange">redex</span> le plus extérieur et le plus à gauche</div>
                <div class="fragment item">et sans descendre dans les abstractions (le $E$ dans $\lambda x.\,E$)</div>
                <div class="fragment item" style="margin-top: 4ex; margin-left: 10em">$\underline{id\:(id\:(\lambda z.\:id\: z))}$</div>
                <div class="fragment item" style="margin-left: 10em">$\underline{id\:(\lambda z.\:id\: z)}$</div>
                <div class="fragment item green" style="margin-left: 10em">$\lambda z.\:id\: z$</div>
                <div class="fragment item " style="margin-top: 3ex">
                    Exemples : Algol60, Miranda, Lazy ML, Clean... <span class="fragment green">Haskell</span> 
                </div>
            </div>
        </section>
        
        <section>
            <h2>Appel par valeur</h2>
            <div class="list" style="margin-bottom: 100%; margin-top: 5ex">
                <div class="fragment item">On prends le <span class="orange">redex</span> le plus extérieur dont l'argument est déjà réduit</div>
                <div class="fragment item">et sans descendre dans les abstractions (le $E$ dans $\lambda x.\,E$)</div>
                <div class="fragment item" style="margin-top: 4ex; margin-left: 10em">$id\:(\underline{id\:(\lambda z.\:id\: z)})$</div>
                <div class="fragment item" style="margin-left: 10em">$\underline{id\:(\lambda z.\:id\: z)}$</div>
                <div class="fragment item green" style="margin-left: 10em">$\lambda z.\:id\: z$</div>
                <div class="fragment item " style="margin-top: 3ex">
                    Exemples : <span class="fragment">tous les autres langages !</span>
                </div>
            </div>
        </section>
        
        <section>
            <h2>Equivalence</h2>
            <img style="margin-top: 3ex; margin-bottom: 100%" src="images/Plotkin.png" alt="Call by name, call by value and the lambda calculus">
        </section>
        
        <section>
            <h2>OCaml</h2>
            <img style="margin-top: 3ex; margin-bottom: 100%" src="images/CAMOriginal.png" alt="Original CAM paper">
        </section>
        
        <section>
            <h2>OCaml</h2>
            <img style="margin-top: 3ex; margin-bottom: 100%" src="images/ZincExperiment.png" alt="ZINC paper">
        </section>
        
        <section>
            <h2>OCaml</h2>
            <img style="margin-top: 3ex; margin-bottom: 100%" src="images/KrivinesMachine.png" alt="Krivine's machine example">
        </section>

        <section data-background-image="images/Interlude.jpg" data-transition="none">
            <h2 style="margin-bottom: 100%">Interlude</h2>
        </section>
       
        <section>
            <span style="font-size: smaller; text-align: left; display: flex; margin: 1ex 0 0 1em">[Seconde Partie]</span>
            <h2 style="margin-top: 3em">Pratique</h2>
            <blockquote style="margin-top: 5em; margin-right: 2em; margin-bottom: 100%">
                « En théorie, il n'y a pas de différence entre la théorie et la pratique. 
                <div>Mais en pratique, il y en a une. »</div>
                <div style="font-size: smaller">&mdash; Yogi Berra</div>
            </blockquote>
        </section>

        <section>
            <h2>Commençons simple...</h2>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 3em"><code class="F#" style="max-height: 800px">
                        let add x y = x + y
            </code></pre>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 1ex"><code class="C#" style="max-height: 800px">
                        public static int Add(int x, int y) => x + y;
            </code></pre>
            <div class="list" style="margin-bottom: 100%; margin-top: 3ex">
                <div class="item fragment">Arguments passés à la fonction (valeurs associée à <span class="magenta">x</span> et <span class="magenta">y</span>)</div>
                <div class="item fragment">Les variables locales</div>
                <div class="item fragment">Les résultats de calculs intermédiaires (par exemple <span class="magenta">x + y</span>)</div>
                <div class="item fragment">Le point (adresse) de retour</div>
                <div class="item fragment" style="margin-top: 2ex">Qui a pensé au mot <span class="blue">pile</span><span class="fragment">... ou <span class="blue">stack</span> pour les anglophiles ?</span></div>
            </div>
        </section>
        
        <section>
            <h2>FORTRAN</h2>
            <div class="list" style="margin-top: 3em; margin-bottom: 100%">
                <div class="item fragment"><span class="magenta">FOR</span>mula <span class="magenta">TRAN</span>slator publié en (avril 1957 - <span class="blue">John Backus</span>)</div>
                <div class="item fragment"><span class="magenta">F66</span> apparition de <span class="code">SUBROUTINE</span> et <span class="code">FUNCTION</span> (mars 1966)</div>
                <div class="item fragment" style="margin-left: 6em">Allocation statique à côté du code de la fonction</div>
                <div class="item fragment" style="margin-top: 1ex; margin-bottom: 1ex"><span class="green">Plusieurs instances de la même fonction ?</span></div>
                <div class="item fragment"><span class="magenta">F77</span> récursivité officieuse (avril 1978)</div>
                <div class="item fragment"><span class="magenta">F90</span> récursivité officielle, <span class="code">RECURSIVE</span> (standard ANSI 1992)</div>
            </div>
        </section>
        
        <section>
            <h2>Récursion simple</h2>
            <div class="list" style="margin-top: 3em">
                <div class="item fragment">Un cas de base ou cas d'arrêt</div>
                <div class="item fragment">Un cas général définit au rang <span class="blue">$n$</span> en fonction du rang <span class="blue">$n - 1$</span></div>
            </div>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 2ex"><code class="F#" style="max-height: 800px">
                        let rec Fact = function
                            | 0u -> 1u
                            | (n: uint) -> n * Fact(n - 1u)
            </code></pre>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 2ex; margin-bottom: 100%"><code class="C#" style="max-height: 800px">
                        public static uint Fact(uint n) => n switch
                        {
                            0u => 1u,
                            _ => n * Fact(n - 1)
                        };
            </code></pre>
        </section>

        <section>
            <h2>Récursion mutuelle</h2>
            <div class="list" style="margin-top: 3em">
                <div class="item fragment" data-fragment-index="1">Plusieurs fonctions récursives se définissent </div>
                <div class="item fragment" data-fragment-index="1">les unes part rapport aux autres</div>
            </div>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 3ex; margin-bottom: 100%"><code class="F#" style="max-height: 800px">
                        let rec IsEven =
                            function
                            | 0u -> true
                            | (n: uint) -> IsOdd(n - 1u)
                        
                        and IsOdd =
                            function
                            | 1u -> true
                            | (n: uint) -> IsEven(n - 1u)
            </code></pre>
        </section>

        <section>
            <h2>Mise en œuvre</h2>
            <div class="list" style="margin-bottom: 100%; margin-top: 3em">
                <div class="item fragment">Plusieurs instances ou <span class="orange">activations</span> d'une même fonction</div>
                <div class="item fragment">Enregistrement d'activation</div>
                <div class="item fragment">... Ou <span class="orange">activation frame</span></div>
                <div class="item fragment">... Ou <span class="orange">activation record</span></div>
                <div class="item fragment" style="margin-top: 2ex">Crée à l'activation</div>
                <div class="item fragment">Plus utile à la désactivation</div>
                <div class="item fragment">$\Rightarrow$ <span class="green">Pile</span></div>
            </div>
        </section>

        <section>
            <h2>Mise en œuvre</h2>
            <div style="margin-top: 3em; display: grid; grid: 'left right' / 0.75fr 1.25fr">
                <div style="grid-area: left">
                    <pre style="max-height: 800px; font-size: 1.1ex; margin-bottom: 100%; margin-top: 0"><code class="F#" data-noescape>
        <span>Main</span>
        <span class="fragment" data-fragment-index="1">  Fact(2)</span>
        <span class="fragment" data-fragment-index="2">    Fact(1)</span>
        <span class="fragment" data-fragment-index="3">      Fact(0)</span>
        <span class="fragment" data-fragment-index="5">    Fact(1)</span>
        <span class="fragment" data-fragment-index="6">  Fact(2)</span>
        <span class="fragment" data-fragment-index="7">Main</span>
                    </code></pre>
                </div>
                <div class="r-stack" style="grid-area: right">
                    <img class="fragment fade-out" data-fragment-index="1" src="images/pile/0.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="1" src="images/pile/1.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="2" src="images/pile/2.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="3" src="images/pile/3.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="4" src="images/pile/4.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="5" src="images/pile/5.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="6" src="images/pile/6.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="7" src="images/pile/7.svg" alt="">
                </div>
            </div>
        </section>

        <section>
            <h2>Fonctions d'Ordre supérieur</h2>
            <div class="list" style="margin-top: 3em">
                <div class="fragment item">Fonctions comme <span class="green">type de première classe</span></div>
                <div class="fragment item">Affectées à des variables</div>
                <div class="fragment item">Passées en argument d'autres fonctions</div>
                <div class="fragment item">Retournées par des fonctions</div>
            </div>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 3ex; margin-bottom: 100%"><code data-no-escape class="C#" style="max-height: 800px">
                public static Func&lt;int, int&gt; AddCurried(int x) => y => x + y;
                        
                var add42 = AddCurried(42)
                var add19 = AddCurried(19)
            </code></pre>
        </section>
        
        <section>
            <h2>Fonction d'Ordre supérieur</h2>
            <div style="margin-top: 3em; display: grid; grid: 'left right' / 0.75fr 1.25fr">
                <div style="grid-area: left">
                    <pre style="max-height: 800px; font-size: 1.1ex; margin-bottom: 100%; margin-top: 0"><code class="F#" data-noescape>
        <span>Main</span>
        <span class="fragment" data-fragment-index="1">  AddCurried(42)</span>
        <span class="fragment" data-fragment-index="3">Main</span>
                    </code></pre>
                </div>
                <div class="r-stack" style="grid-area: right">
                    <img class="fragment fade-out" data-fragment-index="1" src="images/fermeture/0.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="1" src="images/fermeture/1.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="2" src="images/fermeture/2.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="3" src="images/fermeture/3.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="4" src="images/fermeture/4.svg" alt="">
                </div>
            </div>
        </section>
        
        <section>
            <h2>Fonction d'Ordre supérieur</h2>
            <div class="list" style="margin-top: 3em; margin-bottom: 100%">
                <div class="fragment item">Entité qui mémorise <span class="green">code</span> et <span class="green">environnement</span></div>
                <div class="fragment item"><span class="orange">Closure</span>... <span class="fragment">ou <span class="orange">Fermeture</span> pour les francophiles</span></div>
                <div class="fragment item" style="margin-top: 2ex">Survive à un dépilement</div>
                <div class="fragment item">$\Rightarrow$ <span class="green">Tas</span> ou <span class="green">Heap</span> pour...</div>
            </div>
        </section>
        
        <section>
            <h2>Fonction d'Ordre supérieur</h2>
            <div style="margin-top: 3em; display: grid; grid: 'left right' / 0.75fr 1.25fr">
                <div style="grid-area: left">
                    <pre style="max-height: 800px; font-size: 1.1ex; margin-bottom: 100%; margin-top: 0"><code class="F#" data-noescape>
        <span>Main</span>
        <span>  AddCurried(42)</span>
        <span class="fragment" data-fragment-index="6">Main</span>
        <span class="fragment" data-fragment-index="7">  AddCurried(19)</span>
        <span class="fragment" data-fragment-index="9">Main</span>
                    </code></pre>
                </div>
                <div class="r-stack" style="grid-area: right">
                    <img class="fragment fade-out" data-fragment-index="5" src="images/fermeture/1.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="5" src="images/fermeture/5.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="6" src="images/fermeture/6.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="7" src="images/fermeture/7.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="8" src="images/fermeture/8.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="9" src="images/fermeture/9.svg" alt="">
                </div>
            </div>
        </section>
        
        <section>
            <h2>Pile non inclues</h2>
            <img style="margin-bottom: 100%; margin-top: 3ex" src="images/SMLNJ.png" alt="">
        </section>
        
        <section>
            <h2>RISC</h2>
            <div class="list" style="margin-top: 3em; margin-bottom: 100%">
                <div class="item fragment"><span class="magenta">R</span>educed <span class="magenta">I</span>nstruction <span class="magenta">S</span>et <span class="magenta">C</span>omputer</div>
                <div class="item fragment">IBM 801 (1975-1980)</div>
                <div class="item fragment"><span class="blue">David Paterson</span> à Berkeley</div>
                <div class="item fragment">Dec Alpha, IBM POWER, Motorola 88000... (1980 et après)</div>
                <div class="item fragment">RISC-V</div>
                <div class="item fragment" style="margin-top: 1ex">Moins d'instructions plus simples</div>
                <div class="item fragment">Plus de registres généraux</div>
            </div>
        </section>
        
        <section>
            <h2>Appel terminal</h2>
            <div class="list" style="margin-top: 3em">
                <div class="item fragment" data-fragment-index="1">La dernière action d'une fonction est un appel de fonction</div>
            </div>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 2ex"><code class="F#" style="max-height: 800px">
                        let rec FactTailRecursive acc =
                            function
                            | 0u -> acc
                            | (n: uint) -> FactTailRecursive(n * acc) (n - 1u)
            </code></pre>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 2ex; margin-bottom: 100%"><code class="C#" style="max-height: 800px">
                        public static uint FactTailRecursive(uint acc, uint n) => n switch
                        {
                            0u => acc,
                            _ => FactTailRecursive(n * acc, n - 1)
                        };
            </code></pre>
        </section>
        
        <section>
            <h2>Appel terminal</h2>
            <div class="list" style="margin-top: 3em; margin-bottom: 100%">
                <div class="item fragment">Puisqu'il ne restera plus rien à faire au retour de la fonction...</div>
                <div class="item fragment">Autant remonter d'un étage directement !</div>
                <div class="item fragment" style="margin-top: 1ex">Économie d'allocation (espace constant)</div>
                <div class="item fragment">Appel plus rapide</div>
                <div class="item fragment" style="margin-top: 1ex">Style par continuation</div>
                <div class="item fragment">Recursion terminale</div>
            </div>
        </section>

        <section>
            <h2>Mise en œuvre</h2>
            <div style="margin-top: 3em; display: grid; grid: 'left right' / 0.75fr 1.25fr">
                <div style="grid-area: left">
                    <pre style="max-height: 800px; font-size: 1.1ex; margin-bottom: 100%; margin-top: 0"><code class="F#" data-noescape>
        <span>Main</span>
        <span class="fragment" data-fragment-index="1">  Fact(1, 2)</span>
        <span class="fragment" data-fragment-index="3">    Fact(2, 1)</span>
        <span class="fragment" data-fragment-index="5">      Fact(2, 0)</span>
        <span class="fragment" data-fragment-index="7">Main</span>
                    </code></pre>
                </div>
                <div class="r-stack" style="grid-area: right">
                    <img class="fragment fade-out" data-fragment-index="1" src="images/terminal/0.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="1" src="images/terminal/1.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="2" src="images/terminal/2.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="3" src="images/terminal/3.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="4" src="images/terminal/4.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="5" src="images/terminal/5.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="6" src="images/terminal/6.svg" alt="">
                    <img class="fragment fade-in-then-out" data-fragment-index="7" src="images/terminal/7.svg" alt="">
                </div>
            </div>
        </section>
        
        <section>
            <h2>Code produit</h2>
            <div style="margin-top: 1em; display: grid; grid: 'left-header right-header' 'left right' / 1fr 1fr">
                <div style="grid-area: left-header; text-align: left; margin-left: 0.2em">C#</div>
                <div style="grid-area: right-header; text-align: left; margin-left: 0.2em">F#</div>
                <div style="grid-area: left">
                    <pre style="font-size: large; margin-bottom: 100%; margin-top: 0"><code data-noescape>
  .method public hidebysig static unsigned int32
    FactTailRecursive(unsigned int32 acc, unsigned int32 n
    ) cil managed
  {
    [...]
    IL_0000: ldc.i4.1
    IL_0001: brtrue.s     IL_0004

    IL_0003: nop

    IL_0004: ldarg.1      // n
    IL_0005: brfalse.s    IL_0009
    IL_0007: br.s         IL_000d

    IL_0009: ldarg.0      // acc
    IL_000a: stloc.0      // V_0
    IL_000b: br.s         IL_001b

    IL_000d: ldarg.1      // n
    IL_000e: ldarg.0      // acc
    IL_000f: mul
    IL_0010: ldarg.1      // n
    IL_0011: ldc.i4.1
    IL_0012: sub
    IL_0013: call         unsigned int32 CSharp.Factorial::FactTailRecursive(
                              unsigned int32, unsigned int32
                          )
    IL_0018: stloc.0      // V_0
    IL_0019: br.s         IL_001b

    IL_001b: ldc.i4.1
    IL_001c: brtrue.s     IL_001f

    IL_001e: nop

    IL_001f: ldloc.0      // V_0
    IL_0020: ret
  } 
                    </code></pre>
                </div>
                <div style="grid-area: right">
                    <pre style="font-size: large; margin-bottom: 100%; margin-top: 0"><code style="max-height: 800px" data-noescape>
  .method public static unsigned int32
    FactTailRecursive(unsigned int32 acc, unsigned int32 _arg1
    ) cil managed
  {
    [...]
      IL_0000: ldarg.1      // _arg1
      IL_0001: stloc.0      // V_0

      IL_0002: ldloc.0      // V_0
      IL_0003: switch       (IL_000e)
      IL_000c: br.s         IL_0010

      IL_000e: ldarg.0      // acc
      IL_000f: ret

      IL_0010: ldloc.0      // V_0
      IL_0011: stloc.1      // n

      IL_0012: ldloc.1      // n
      IL_0013: ldarg.0      // acc
      IL_0014: mul
      IL_0015: ldloc.1      // n
      IL_0016: ldc.i4.1
      IL_0017: sub
      IL_0018: starg.s      _arg1
      IL_001a: starg.s      acc
      IL_001c: br.s         IL_0000
  } 
                    </code></pre>
                </div>
            </div>
        </section>

        <section>
            <h2>Code produit</h2>
            <div style="margin-top: 1em; display: grid; grid: 'left-header right-header' 'left right' / 1fr 1fr">
                <div style="grid-area: left-header; text-align: left; margin-left: 0.2em">C#</div>
                <div style="grid-area: right-header; text-align: left; margin-left: 0.2em">F#</div>
                <div style="grid-area: left">
                    <pre style="font-size: large; margin-bottom: 100%; margin-top: 0"><code data-noescape>
  .method public hidebysig static unsigned int32
    <span class="ch">FactTailRecursive(unsigned int32 acc, unsigned int32 n</span>
    ) cil managed
  {
    [...]
    IL_0000: ldc.i4.1
    IL_0001: brtrue.s     IL_0004

    IL_0003: nop

    IL_0004: ldarg.1      // n
    IL_0005: brfalse.s    IL_0009
    IL_0007: br.s         IL_000d

    IL_0009: ldarg.0      // acc
    IL_000a: stloc.0      // V_0
    IL_000b: br.s         IL_001b

    IL_000d: ldarg.1      // n
    IL_000e: ldarg.0      // acc
    IL_000f: mul
    IL_0010: ldarg.1      // n
    IL_0011: ldc.i4.1
    IL_0012: sub
    IL_0013: <span class="ch">call         unsigned int32 CSharp.Factorial::FactTailRecursive(</span>
             <span class="ch">                 unsigned int32, unsigned int32</span>
             <span class="ch">             )</span>
    IL_0018: stloc.0      // V_0
    IL_0019: br.s         IL_001b

    IL_001b: ldc.i4.1
    IL_001c: brtrue.s     IL_001f

    IL_001e: nop

    IL_001f: ldloc.0      // V_0
    IL_0020: ret
  } 
                    </code></pre>
                </div>
                <div style="grid-area: right">
                    <pre style="font-size: large; margin-bottom: 100%; margin-top: 0"><code style="max-height: 800px" data-noescape>
  .method public static unsigned int32
    FactTailRecursive(unsigned int32 acc, unsigned int32 _arg1
    ) cil managed
  {
      [...]
      <span class="ch">IL_0000</span>: ldarg.1      // _arg1
      IL_0001: stloc.0      // V_0

      IL_0002: ldloc.0      // V_0
      IL_0003: switch       (IL_000e)
      IL_000c: br.s         IL_0010

      IL_000e: ldarg.0      // acc
      IL_000f: ret

      IL_0010: ldloc.0      // V_0
      IL_0011: stloc.1      // n

      IL_0012: ldloc.1      // n
      IL_0013: ldarg.0      // acc
      IL_0014: mul
      IL_0015: ldloc.1      // n
      IL_0016: ldc.i4.1
      IL_0017: sub
      IL_0018: starg.s      _arg1
      IL_001a: starg.s      acc
      IL_001c: <span class="ch">br.s         IL_0000</span>
  } 
                    </code></pre>
                </div>
            </div>
        </section>

        <section>
            <h2>Comment rebondir ?</h2>
            <div class="list" style="margin-top: 3em; margin-bottom: 100%">
                <div class="item fragment" data-fragment-index="1" >On voudrait exprimer un algo récursif...</div>
                <div class="item fragment" data-fragment-index="2" >Mais le compilateur ne nous aide pas...</div>
                <div class="item fragment" data-fragment-index="3" >Comment forcer le dépilement l'activation courante ?</div>
                <div class="item fragment" data-fragment-index="4"  style="margin-top: 2ex">En utilisant un <span class="orange">trampoline</span></div>
                <div class="item fragment" data-fragment-index="5" style="margin-top: 2ex">Principe : </div>
                <div class="item fragment" data-fragment-index="6" style="margin-left: 8em;margin-top: 1ex">Retourner une valeur qui exprime </div>
                <div class="item fragment" data-fragment-index="6"  style="margin-left: 8em">un « <span class="green">reste à faire</span> » ou un résultat</div>
                <div class="item fragment" data-fragment-index="7"  style="margin-left: 8em; margin-top: 1ex">Invoquer le « <span class="green">reste à faire</span> » dans une boucle</div>
                <div class="item fragment" data-fragment-index="7"  style="margin-left: 8em">ou retourner le résultat</div>
            </div>
        </section>
        
        <section>
            <h2>Trampoline</h2>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 3em"><code class="C#" style="max-height: 800px">
                public interface ITailRec&lt;out T&gt; {
                    public T Run() { ... }
                }
        
                public struct Return&lt;T&gt; : ITailRec&lt;T&gt; {
                    public T Value { get; init; }
                }
        
                public struct Suspend&lt;T&gt; : ITailRec&lt;T&gt; {
                    public Func&lt;ITailRec&lt;T&gt;&gt; Thunk { get; init; }
                }
            </code></pre>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 1ex; margin-bottom: 100%"><code class="C#" style="max-height: 800px">
                public static ITailRec&lt;uint&gt; FactTrampoline(uint acc, uint n) => n switch {
                            0 => new Return&lt;uint&gt; { Value = acc },
                            _ => new Suspend&lt;uint&gt; { Thunk = () => FactTrampoline(n * acc, n - 1) 
                        }
                    };
                }
            </code></pre>
        </section>

        <section>
            <h2>Trampoline</h2>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 3em"><code class="C#" style="max-height: 800px">
                FactTrampoline(1, 3).run()
            </code></pre>
            <pre class="fragment" style="font-size: 1.1ex; margin-top: 1ex; margin-bottom: 100%"><code class="C#" style="max-height: 800px">
                public interface ITailRec&lt;out T&gt; {
                    public T Run() {
                        var current = this;
                        for (;;)
                            switch (current) {
                                case Return&lt;T&gt; @return: return @return.Value;
                                case Suspend&lt;T&gt; suspend:
                                    current = suspend.Thunk();
                                    break;
                            }
                    }
                }
            </code></pre>
        </section>

        <section>
            <h2>Coda</h2>
            <div class="list" style="margin-top: 3em; margin-bottom: 100%">
                <div class="fragment item">Continuations</div>
                <div class="fragment item">Coroutines</div>
                <div class="fragment item">Lambda Lifting</div>
                <div class="fragment item">...</div>
            </div>
        </section>
        
        <section>
            <h2>Ressources</h2>
            <div style="display: grid;  grid: 'left right' / 1fr 1fr">
                <img class="fragment" style="grid-area: left; justify-self: center; margin-top: 3ex" src="images/Appel.png" alt="Modern Compiler Implementation in ML">
                <div class="list" style="grid-area: right; margin-top: 3ex; margin-bottom: 100%">
                    <div  class="item fragment">The ZINC Experiment<a href="https://xavierleroy.org/publi/ZINC.pdf"> [PDF]</a></div>
                    <div class="item fragment">Standard ML of New Jersey<a href="https://www.cs.princeton.edu/~appel/papers/smlnj.pdf"> [PDF]</a></div>
                    <div class="item fragment">Wikipedia<a href="https://www.wikipedia.org/"> [Web]</a></div>
                </div>
            </div>
        </section>

        <section>
            <div style="display: flex; justify-content: space-between">
                <div style="margin-left: 2em; display: flex; flex-direction: column">
                    <div style="margin-top: 1em; text-align: left" class="green">Frédéric Cabestre</div>
                    <div style="font-size: smaller; text-align: left" class="blue">@fcabestre</div>
                </div>
            </div>
            <h1 style="margin-top: 1.5em ; ">Merci</h1>
            <div style="display: flex; justify-content: right; margin-top: 3ex; margin-bottom: 100%">
            </div>
        </section>

    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="plugin/math/math.js"></script>
<script src="dist/d3/d3.min.js"></script>

<script>
    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,
        width: 1600,
        height: 900,

        transition: "none",
        
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.KaTeX ],
        
        katex: {
            local: "dist/katex",
        },
        
        dependencies: [
            {
                src: "dist/reveal-svg-fragment/reveal-svg-fragment.js",
                condition: function () {
                    return !!document.querySelector("[data-svg-fragment]");
                },
            },
        ],
    });
</script>
</body>
</html>
